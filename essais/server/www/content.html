<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta charset="utf-8" />
		<link rel="stylesheet" type="text/css" href="https://ada-sub.dh-index.org/school/css/style.css" />
		<title>12212.papers</title>
  <style>
    #container { display: flex; gap: 2rem; }
    #content { margin-top: 2%;width: 15%; top:90px;border-right: 2px solid black; padding-right: 1rem; position: fixed;display: block}
    #file_content { flex: 1; 
        padding-left: 25%; margin-top: 60px;  }
    #content-frame { flex: 1; 
        padding-left: 25%; margin-top: 60px;  display:none;}
    
    #content ul { list-style: none; padding: 0; }
    #content li { margin: 0.5rem 0; cursor: pointer; color: blue; }
    #content li:hover { text-decoration: none; }
    .index {margin-top:unset;padding-top:1%; position: fixed;height:60px;z-index:1000;background-color: #fbfbfb;display: block;top: 1%;width:100%;border-bottom:2px solid black;}
    #blank {top: 0px;position:fixed;width:100%;background-color:#fbfbfb;}
    #c_name {font-size:0.8em;color:cadetblue}

  </style>
</head>
<body>
    <div id="blank">16011.snc</div>      
    <h1 class="index">INDEX<span>     //   </span><span id="c_name">browse...</span></h1></h1>
  <div id="container">
    
    <div id="content">
  <!-- Filled by JS with list of titles -->
      Loading list...

    </div>
                <!-- <iframe id="content-frame" title="Isolated Content" style="border:none; width:100%; height:500px;"></iframe> -->

    <div id="file_content">
      <!-- Selected doc content will be inserted here -->
      Select a document from the list.

    </div>
  </div>

  <script>
    async function fetchJson(url) {
      const res = await fetch(url);
      if (!res.ok) throw new Error("HTTP " + res.status);
      return res.json();
    }

    async function fetchText(url) {
      const res = await fetch(url);
      if (!res.ok) throw new Error("HTTP " + res.status);
      return res.text();
    }

    async function init() {
      const listDiv = document.getElementById("content");
      const contentDiv = document.getElementById("file_content");
      const contentTitle = document.getElementById("c_name");
      // const shadow = contentDiv.attachShadow({ mode: 'open' });
      const iframe = document.getElementById('content-frame');
      const htmlfixed =  `
  <style>
    :host { all: initial; display: block; } /* Reset all inherited styles */
    h1 { color: blue; } /* Styles apply ONLY inside this shadow DOM */
  </style>
  <div class="child-content">
    <h1>Isolated Content</h1>
    <p>Parent CSS cannot touch me!</p>
  </div>
`;

      // const shadow = document.createElement("iframe");

      let docs;
      try {
        docs = await fetchJson("/query");
      } catch (e) {
        listDiv.textContent = "Error loading list: " + e.message;
        return;
      }

      // Option A: lazy-load content on click (simpler, network-light)
      // Option B: prefetch all content; here we'll do lazy-load to start.

      const ul = document.createElement("ul");
      docs.forEach(doc => {
        const li = document.createElement("li");
        li.textContent = doc.title;
        li.addEventListener("click", async () => {
          try {

            const html = await fetchText(doc.path);
            // Insert the raw HTML; you might want to sanitize in real apps.
            contentDiv.innerHTML = html;
            // shadow.innerHTML = html;
            // iframe.srcdoc = htmlContent;
            // iframe.srcdoc = htmlfixed;
            // iframe.srcdoc = html;

            contentTitle.innerHTML = doc.title;

          } catch (e) {
            contentDiv.textContent = "Error loading document: " + e.message;
          }
        });
        ul.appendChild(li);
      });

      listDiv.innerHTML = "";
      listDiv.appendChild(ul);
    }

    init();
  </script>
</body>
</html>
